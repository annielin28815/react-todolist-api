{"ast":null,"code":"import _regeneratorRuntime from\"D:/personal/sideProject/react-todolist-page/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/personal/sideProject/react-todolist-page/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/personal/sideProject/react-todolist-page/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from'react';import{NavLink,useNavigate}from'react-router-dom';import{useForm}from'react-hook-form';import Loading from'../../../components/Loading';import MySwal from'../../../components/Swql';import{setUserData,getUserData}from'../../../global/constants';import{LoginApi}from'../../../global/todoApi';import FormInput from'./FormInput';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Login=function Login(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoading=_useState2[0],setLoading=_useState2[1];var navigate=useNavigate();var _useForm=useForm(),register=_useForm.register,handleSubmit=_useForm.handleSubmit,errors=_useForm.formState.errors;var fetchLogin=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(user){var res,data,headers,status,nickname,error,authorization;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setLoading(true);_context.next=3;return LoginApi(user);case 3:res=_context.sent;_context.next=6;return res.json();case 6:data=_context.sent;headers=res.headers,status=res.status;nickname=data.nickname,error=data.error;authorization=headers.get('authorization');setLoading(false);if(status===200){setUserData({nickname:nickname,authorization:authorization});navigate('/Todo');}else if(status===401){MySwal.fire({toast:true,position:'top-end',icon:'error',showConfirmButton:false,timer:1500,timerProgressBar:true,title:error});}case 12:case\"end\":return _context.stop();}}},_callee);}));return function fetchLogin(_x){return _ref.apply(this,arguments);};}();useEffect(function(){if(getUserData()!==null){navigate('/Todo');}},[]);var formInputList=[{type:'text',id:'email',placeholder:'請輸入 Email',verify:{required:{value:true,message:'此欄位必填'},pattern:{value:/^[\\w-\\.]+@([\\w-]+\\.)+[\\w-]{2,4}$/g,message:'不符合 Email 規則'}},labelText:'Email'},{type:'password',id:'password',placeholder:'請輸入密碼',verify:{required:{value:true,message:'此欄位必填'}},labelText:'密碼'}];return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"form\",{className:\"formControls\",onSubmit:handleSubmit(fetchLogin),children:[/*#__PURE__*/_jsx(\"h2\",{className:\"formControls_txt\",children:\"\\u6700\\u5BE6\\u7528\\u7684\\u7DDA\\u4E0A\\u4EE3\\u8FA6\\u4E8B\\u9805\\u670D\\u52D9\"}),formInputList.map(function(item){return/*#__PURE__*/_jsx(FormInput,{item:item,register:register,errors:errors},item.id);}),/*#__PURE__*/_jsx(\"input\",{className:\"formControls_btnSubmit\",type:\"submit\",value:\"\\u767B\\u5165\",disabled:Object.keys(errors).length>0}),/*#__PURE__*/_jsx(NavLink,{className:\"formControls_btnLink\",to:\"/register\",children:\"\\u8A3B\\u518A\\u5E33\\u865F\"})]}),isLoading?/*#__PURE__*/_jsx(Loading,{}):'']});};export default Login;","map":{"version":3,"names":["useState","useEffect","NavLink","useNavigate","useForm","Loading","MySwal","setUserData","getUserData","LoginApi","FormInput","Login","isLoading","setLoading","navigate","register","handleSubmit","errors","formState","fetchLogin","user","res","json","data","headers","status","nickname","error","authorization","get","fire","toast","position","icon","showConfirmButton","timer","timerProgressBar","title","formInputList","type","id","placeholder","verify","required","value","message","pattern","labelText","map","item","Object","keys","length"],"sources":["D:/personal/sideProject/react-todolist-page/src/pages/home/components/Login.js"],"sourcesContent":["import { useState, useEffect } from 'react';\r\n\r\nimport { NavLink, useNavigate } from 'react-router-dom';\r\n\r\nimport { useForm } from 'react-hook-form';\r\n\r\nimport Loading from '../../../components/Loading';\r\nimport MySwal from '../../../components/Swql';\r\n\r\nimport { setUserData, getUserData } from '../../../global/constants';\r\n\r\nimport { LoginApi } from '../../../global/todoApi';\r\n\r\nimport FormInput from './FormInput';\r\n\r\nconst Login = () => {\r\n    const [isLoading, setLoading] = useState(false);\r\n    const navigate = useNavigate();\r\n\r\n    const {\r\n        register,\r\n        handleSubmit,\r\n        formState: { errors },\r\n    } = useForm();\r\n\r\n    const fetchLogin = async (user) => {\r\n        setLoading(true);\r\n        const res = await LoginApi(user);\r\n        const data = await res.json();\r\n\r\n        const { headers, status } = res;\r\n        const { nickname, error } = data;\r\n\r\n        const authorization = headers.get('authorization');\r\n        setLoading(false);\r\n\r\n        if (status === 200) {\r\n            setUserData({\r\n                nickname,\r\n                authorization,\r\n            });\r\n\r\n            navigate('/Todo');\r\n        } else if (status === 401) {\r\n            MySwal.fire({\r\n                toast: true,\r\n                position: 'top-end',\r\n                icon: 'error',\r\n                showConfirmButton: false,\r\n                timer: 1500,\r\n                timerProgressBar: true,\r\n                title: error,\r\n            });\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (getUserData() !== null) {\r\n            navigate('/Todo');\r\n        }\r\n    }, []);\r\n\r\n    const formInputList = [\r\n        {\r\n            type: 'text',\r\n            id: 'email',\r\n            placeholder: '請輸入 Email',\r\n            verify: {\r\n                required: { value: true, message: '此欄位必填' },\r\n                pattern: {\r\n                    value: /^[\\w-\\.]+@([\\w-]+\\.)+[\\w-]{2,4}$/g,\r\n                    message: '不符合 Email 規則',\r\n                },\r\n            },\r\n            labelText: 'Email',\r\n        },\r\n        {\r\n            type: 'password',\r\n            id: 'password',\r\n            placeholder: '請輸入密碼',\r\n            verify: {\r\n                required: { value: true, message: '此欄位必填' },\r\n            },\r\n            labelText: '密碼',\r\n        },\r\n    ];\r\n\r\n    return (\r\n        <>\r\n            <form className='formControls' onSubmit={handleSubmit(fetchLogin)}>\r\n                <h2 className='formControls_txt'>最實用的線上代辦事項服務</h2>\r\n                {formInputList.map((item) => (\r\n                    <FormInput\r\n                        key={item.id}\r\n                        item={item}\r\n                        register={register}\r\n                        errors={errors}\r\n                    />\r\n                ))}\r\n                <input\r\n                    className='formControls_btnSubmit'\r\n                    type='submit'\r\n                    value='登入'\r\n                    disabled={Object.keys(errors).length > 0}\r\n                />\r\n                <NavLink className='formControls_btnLink' to='/register'>\r\n                    註冊帳號\r\n                </NavLink>\r\n            </form>\r\n            {isLoading ? <Loading /> : ''}\r\n        </>\r\n    );\r\n};\r\n\r\nexport default Login;"],"mappings":"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"},"metadata":{},"sourceType":"module"}